(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15277,        376]
NotebookOptionsPosition[     13779,        345]
NotebookOutlinePosition[     14183,        361]
CellTagsIndexPosition[     14140,        358]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "@@", 
  RowBox[{"Names", "@", "\"\<`*\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$HistoryLength", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pwd", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "pwd", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.76234066490754*^9, 3.762340665436069*^9}, {
  3.762340703357275*^9, 3.762340704359076*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"a4bf7f56-caa8-45c4-9a2c-2d3a73bce717"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"zipsdirty", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"\"\<AREADIST_ZIP5_1.TXT\>\"", ",", "\"\<Table\>\""}], "]"}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"zips", "=", 
     RowBox[{
      RowBox[{"Select", "[", 
       RowBox[{"zipsdirty", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "\[NotEqual]", 
           "\"\<CARIBBEAN\>\""}], "&&", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", " ", 
           "\"\<OVERSEAS\>\""}], "&&", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[NotEqual]", " ", 
           "\"\<HEADQUARTERS\>\""}]}], "&"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"zipsdirty", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"\"\<zip_code_list.csv\>\"", ",", "\"\<csv\>\""}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.762355774503747*^9, 3.762355793007681*^9}, {
   3.7623560280290594`*^9, 3.7623560289918833`*^9}, {3.7623566846282663`*^9, 
   3.7623567683477125`*^9}, {3.762357313487819*^9, 3.7623573607784805`*^9}, {
   3.7623573967038126`*^9, 3.7623574023440533`*^9}, {3.7623575848708596`*^9, 
   3.7623575869458504`*^9}, {3.762358425808159*^9, 3.762358450312337*^9}, {
   3.7623584947568674`*^9, 3.76235853255711*^9}, {3.762363474772769*^9, 
   3.762363537997631*^9}, {3.7623635721972723`*^9, 3.7623635863759017`*^9}, 
   3.762515607541501*^9},
 CellLabel->"In[23]:=",ExpressionUUID->"a6b21140-3e0d-4aee-93b5-9f58c5b5a2a4"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"zips", "=", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"zipsdirty", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "==", "\"\<STANDARD\>\""}], "&&", 
         " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "\[NotEqual]", "\"\<PR\>\""}], "&&",
          " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "\[NotEqual]", "\"\<AK\>\""}], "&&",
          " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "\[NotEqual]", "\"\<HI\>\""}], "&&",
          " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "\[NotEqual]", "\"\<VI\>\""}], "&&", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "7", "]"}], "]"}], "\[NotEqual]", "\"\<GU\>\""}]}], 
        "&"}]}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Nezips", "=", 
     RowBox[{
      RowBox[{"Select", "[", 
       RowBox[{"zipsdirty", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "==", "\"\<STANDARD\>\""}], "&&", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "7", "]"}], "]"}], "\[Equal]", "\"\<NE\>\""}]}], 
         "&"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"zips", "=", "Nezips"}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "zips", "]"}], "\n", 
 RowBox[{
  RowBox[{"zips", "=", 
   RowBox[{"ToString", "/@", "zips"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"zipcheck", "[", "x_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"StringLength", "[", "x", "]"}], "<", "5"}], ",", 
     RowBox[{"StringJoin", "[", 
      RowBox[{"\"\<0\>\"", ",", "x"}], "]"}], ",", "x"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"zips", "=", 
   RowBox[{"zipcheck", "/@", "zips"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ziplc", "[", "x_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"StringLength", "[", "x", "]"}], "<", "5"}], ",", "True", ",", 
     "False"}], "]"}]}], ";"}], "\n", 
 RowBox[{"MemberQ", "[", 
  RowBox[{"True", ",", 
   RowBox[{"ziplc", "/@", "zips"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"n", "=", 
  RowBox[{
   RowBox[{"Dimensions", "[", "zips", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Export", "[", 
    RowBox[{"\"\<zips_clean.csv\>\"", ",", "zips"}], "]"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7623636030252867`*^9, 3.7623636325624084`*^9}, {
   3.7623637728953514`*^9, 3.7623637828171844`*^9}, {3.7623638186312065`*^9, 
   3.762363821270975*^9}, {3.762363855434284*^9, 3.7623638880630455`*^9}, {
   3.7623639365116067`*^9, 3.762363969988968*^9}, {3.762364002078768*^9, 
   3.7623640509638634`*^9}, {3.76236421019339*^9, 3.762364345559383*^9}, {
   3.762364390549487*^9, 3.762364490642927*^9}, {3.7623680601558948`*^9, 
   3.7623680632585444`*^9}, 3.762515616781412*^9, {3.7625156584575796`*^9, 
   3.7625157198743525`*^9}, {3.7625157504167805`*^9, 3.762515797826674*^9}, {
   3.7625198345574665`*^9, 3.762519844552001*^9}, {3.76251988893414*^9, 
   3.762519911556258*^9}, {3.762534413962537*^9, 3.762534480835839*^9}, {
   3.7625465727172174`*^9, 3.762546602045658*^9}, {3.7625467365768023`*^9, 
   3.762546769124826*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"613a7fb8-7334-4eaa-8cbf-18d6f4caf6f5"],

Cell[BoxData[
 RowBox[{"{", "29718", "}"}]], "Output",
 CellChangeTimes->{
  3.762358683301882*^9, {3.7623644646916666`*^9, 3.7623644927519064`*^9}, 
   3.7623651179010544`*^9, {3.762515725551166*^9, 3.76251575817735*^9}, 
   3.762515802269742*^9, 3.762516325909442*^9, {3.7625198517547426`*^9, 
   3.7625198800041523`*^9}, 3.7625199167967157`*^9, 3.762528271796234*^9, {
   3.7625344576489477`*^9, 3.7625344815632963`*^9}, 3.7625465966568775`*^9, 
   3.7625468121097765`*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"34ffd2dd-0d52-4497-8638-e84a5951d259"],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{
  3.762358683301882*^9, {3.7623644646916666`*^9, 3.7623644927519064`*^9}, 
   3.7623651179010544`*^9, {3.762515725551166*^9, 3.76251575817735*^9}, 
   3.762515802269742*^9, 3.762516325909442*^9, {3.7625198517547426`*^9, 
   3.7625198800041523`*^9}, 3.7625199167967157`*^9, 3.762528271796234*^9, {
   3.7625344576489477`*^9, 3.7625344815632963`*^9}, 3.7625465966568775`*^9, 
   3.762546812220481*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"1b978ae5-88e1-4c25-800d-b285095f2712"],

Cell[BoxData["29718"], "Output",
 CellChangeTimes->{
  3.762358683301882*^9, {3.7623644646916666`*^9, 3.7623644927519064`*^9}, 
   3.7623651179010544`*^9, {3.762515725551166*^9, 3.76251575817735*^9}, 
   3.762515802269742*^9, 3.762516325909442*^9, {3.7625198517547426`*^9, 
   3.7625198800041523`*^9}, 3.7625199167967157`*^9, 3.762528271796234*^9, {
   3.7625344576489477`*^9, 3.7625344815632963`*^9}, 3.7625465966568775`*^9, 
   3.7625468122214775`*^9},
 CellLabel->"Out[31]=",ExpressionUUID->"2d835b6b-9a2d-430b-b01f-1cd2695e93b7"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"entmaker", "[", "x_", "]"}], ":=", 
  RowBox[{"Entity", "[", 
   RowBox[{"\"\<ZIPCode\>\"", ",", " ", 
    RowBox[{"ToString", "[", "x", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"entzip", "=", 
   RowBox[{"entmaker", "/@", "zips"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"testscore", "=", 
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", "n"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"testscore", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"N", "[", 
        RowBox[{"PDF", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0.8", ",", "0.2"}], "]"}], ",", "i"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "1", ",", 
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}], "}"}]}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"poly", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"EntityValue", "[", 
      RowBox[{"#", ",", 
       RowBox[{"EntityProperty", "[", 
        RowBox[{"\"\<ZIPCode\>\"", ",", "\"\<Polygon\>\""}], "]"}]}], "]"}], 
     "&"}], "/@", "entzip"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rule", "=", 
   RowBox[{"Rule", "@@@", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"entzip", ",", "testscore"}], "}"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76235848113373*^9, 3.762358481321438*^9}, {
   3.762358804977808*^9, 3.7623588061023707`*^9}, 3.7625200106367116`*^9, 
   3.7625200711197863`*^9, {3.762546799812625*^9, 3.7625468030859404`*^9}, {
   3.7626036016776485`*^9, 
   3.7626036348785095`*^9}},ExpressionUUID->"52e0c28d-aec0-4534-a3a6-\
b7164deb6ed4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AbsoluteTiming", "[", 
  RowBox[{"GeoRegionValuePlot", "[", 
   RowBox[{"rule", ",", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<AvocadoColors\>\""}], ",", 
    RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Opacity", "[", "1.", "]"}]}], ",", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"BarLegend", "[", "Automatic", "]"}]}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7625377306266937`*^9, 3.762537741097995*^9}, {
  3.7625466774203854`*^9, 3.7625467100885487`*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"69a4bbbd-08af-4645-a6e5-1700648d52ac"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{
  3.762539908919719*^9, {3.7625466718891177`*^9, 3.762546680615259*^9}, 
   3.76254671290576*^9, 3.7625484738018937`*^9},
 CellLabel->"Out[36]=",ExpressionUUID->"9c261ae6-4116-4dad-8d3e-e73b26f4effd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"GeoRegionValuePlot", "[", 
   RowBox[{"rule", ",", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<AvocadoColors\>\""}], ",", 
    RowBox[{"MissingStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{
       RowBox[{"Opacity", "[", "1.0", "]"}], ",", "White", ",", 
       RowBox[{"EdgeForm", "[", "Dashed", "]"}]}], "]"}]}], ",", 
    RowBox[{"ColorFunctionScaling", "\[Rule]", "True"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Opacity", "[", "1.", "]"}]}], ",", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"BarLegend", "[", "Automatic", "]"}]}]}], "]"}], "%%", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.762358536687169*^9, 3.7623586180925493`*^9}, {
   3.7625158443705006`*^9, 3.76251586234072*^9}, 3.7625159126744933`*^9, {
   3.7625159732865763`*^9, 3.762515975697734*^9}, {3.762516071501381*^9, 
   3.7625161982185335`*^9}, {3.762516231437844*^9, 3.762516237967802*^9}, {
   3.7625162741253924`*^9, 3.7625162767836003`*^9}, {3.7625163154286375`*^9, 
   3.7625163159188447`*^9}, {3.762516349819132*^9, 3.7625163692499776`*^9}, {
   3.762516438228057*^9, 3.7625164470937104`*^9}, {3.7625164888881545`*^9, 
   3.76251649108873*^9}, {3.762516610629142*^9, 3.762516620842703*^9}, {
   3.7625167069078665`*^9, 3.7625167485744324`*^9}, {3.7625167924607224`*^9, 
   3.7625167946522155`*^9}, {3.762516859069207*^9, 3.762517014814129*^9}, {
   3.7625170888517504`*^9, 3.7625170971466675`*^9}, {3.762517889702032*^9, 
   3.76251791766079*^9}, {3.7625179571497116`*^9, 3.7625180001660533`*^9}, {
   3.762518031473332*^9, 3.762518032523221*^9}, {3.7625181555059977`*^9, 
   3.76251816317304*^9}, {3.762518193503475*^9, 3.762518222979472*^9}, {
   3.762518758223325*^9, 3.762518817557847*^9}, {3.7625198167513556`*^9, 
   3.7625198280967197`*^9}, {3.762520210075528*^9, 3.762520224179859*^9}, {
   3.7625282142327604`*^9, 3.7625282229187603`*^9}, {3.7625375215262537`*^9, 
   3.7625375409221373`*^9}},ExpressionUUID->"a048643c-921c-4fea-a61c-\
eb4a179594a1"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{{3.762518225766367*^9, 3.762518237497885*^9}, 
   3.762518820802431*^9, 3.76252020155974*^9, 3.762528208845374*^9, 
   3.762537507921957*^9},
 CellLabel->"Out[36]=",ExpressionUUID->"d9e20bd2-3997-442f-b39f-b4b8408a1695"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.762518174203766*^9, 
  3.7625181757897162`*^9}},ExpressionUUID->"d3ce8f9f-d27f-4c89-99c4-\
e47ab365411e"]
},
WindowSize->{1368, 869},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
WindowStatusArea->"Prefetching related knowledgebase data.",
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 561, 12, 86, "Input",ExpressionUUID->"a4bf7f56-caa8-45c4-9a2c-2d3a73bce717"],
Cell[1122, 34, 1839, 44, 105, "Input",ExpressionUUID->"a6b21140-3e0d-4aee-93b5-9f58c5b5a2a4"],
Cell[CellGroupData[{
Cell[2986, 82, 3842, 101, 219, "Input",ExpressionUUID->"613a7fb8-7334-4eaa-8cbf-18d6f4caf6f5"],
Cell[6831, 185, 555, 9, 32, "Output",ExpressionUUID->"34ffd2dd-0d52-4497-8638-e84a5951d259"],
Cell[7389, 196, 531, 8, 32, "Output",ExpressionUUID->"1b978ae5-88e1-4c25-800d-b285095f2712"],
Cell[7923, 206, 533, 8, 32, "Output",ExpressionUUID->"2d835b6b-9a2d-430b-b01f-1cd2695e93b7"]
}, Open  ]],
Cell[8471, 217, 1851, 53, 124, "Input",ExpressionUUID->"52e0c28d-aec0-4534-a3a6-b7164deb6ed4"],
Cell[CellGroupData[{
Cell[10347, 274, 651, 12, 28, "Input",ExpressionUUID->"69a4bbbd-08af-4645-a6e5-1700648d52ac"],
Cell[11001, 288, 256, 4, 32, "Output",ExpressionUUID->"9c261ae6-4116-4dad-8d3e-e73b26f4effd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11294, 297, 2034, 34, 48, "Input",ExpressionUUID->"a048643c-921c-4fea-a61c-eb4a179594a1"],
Cell[13331, 333, 275, 4, 32, "Output",ExpressionUUID->"d9e20bd2-3997-442f-b39f-b4b8408a1695"]
}, Open  ]],
Cell[13621, 340, 154, 3, 28, "Input",ExpressionUUID->"d3ce8f9f-d27f-4c89-99c4-e47ab365411e"]
}
]
*)

